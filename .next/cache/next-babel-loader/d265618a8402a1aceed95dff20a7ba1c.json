{"ast":null,"code":"import axios from 'axios';\nimport Router from 'next/router';\nimport { Cookies } from 'react-cookie'; // set up cookies\n\nconst cookies = new Cookies();\nconst serverUrl = 'http://localhost:3001';\nexport async function handleAuthSSR(ctx) {\n  let token = null; // if context has request info aka Server Side\n\n  if (ctx.req) {\n    // ugly way to get cookie value from a string of values\n    // good enough for demostration\n    token = ctx.req.headers.cookie.replace(/(?:(?:^|.*;\\s*)token\\s*\\=\\s*([^;]*).*$)|^.*$/, \"$1\");\n  } else {\n    // we dont have request info aka Client Side\n    token = cookies.get('token');\n  }\n\n  try {\n    console.log('vaimee');\n    const response = await axios.get(serverUrl + \"/api/token/ping\", {\n      headers: {\n        'Authorization': token\n      }\n    }); // dont really care about response, as long as it not an error\n\n    console.log(\"token ping:\", response.data.msg);\n  } catch (err) {\n    // in case of error\n    console.log(err.response.data.msg);\n    console.log(\"redirecting back to main page\"); // redirect to login\n\n    if (ctx.res) {\n      ctx.res.writeHead(302, {\n        Location: '/'\n      });\n      ctx.res.end();\n    } else {\n      Router.push('/');\n    }\n  }\n}","map":{"version":3,"sources":["C:/Users/Roglol/Desktop/dekori/utils/auth.js"],"names":["axios","Router","Cookies","cookies","serverUrl","handleAuthSSR","ctx","token","req","headers","cookie","replace","get","console","log","response","data","msg","err","res","writeHead","Location","end","push"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,SAASC,OAAT,QAAwB,cAAxB,C,CACA;;AACA,MAAMC,OAAO,GAAG,IAAID,OAAJ,EAAhB;AACA,MAAME,SAAS,GAAG,uBAAlB;AAEA,OAAO,eAAeC,aAAf,CAA6BC,GAA7B,EAAkC;AACvC,MAAIC,KAAK,GAAG,IAAZ,CADuC,CAGvC;;AACA,MAAID,GAAG,CAACE,GAAR,EAAa;AACX;AACA;AACAD,IAAAA,KAAK,GAAGD,GAAG,CAACE,GAAJ,CAAQC,OAAR,CAAgBC,MAAhB,CAAuBC,OAAvB,CAA+B,8CAA/B,EAA+E,IAA/E,CAAR;AACD,GAJD,MAKK;AACH;AACAJ,IAAAA,KAAK,GAAGJ,OAAO,CAACS,GAAR,CAAY,OAAZ,CAAR;AACD;;AAED,MAAI;AACFC,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACA,UAAMC,QAAQ,GAAG,MAAMf,KAAK,CAACY,GAAN,CAAUR,SAAS,GAAG,iBAAtB,EAAyC;AAAEK,MAAAA,OAAO,EAAE;AAAE,yBAAiBF;AAAnB;AAAX,KAAzC,CAAvB,CAFE,CAGF;;AACAM,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BC,QAAQ,CAACC,IAAT,CAAcC,GAAzC;AACD,GALD,CAKE,OAAOC,GAAP,EAAY;AACZ;AACAL,IAAAA,OAAO,CAACC,GAAR,CAAYI,GAAG,CAACH,QAAJ,CAAaC,IAAb,CAAkBC,GAA9B;AACAJ,IAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ,EAHY,CAIZ;;AACA,QAAIR,GAAG,CAACa,GAAR,EAAa;AACXb,MAAAA,GAAG,CAACa,GAAJ,CAAQC,SAAR,CAAkB,GAAlB,EAAuB;AACrBC,QAAAA,QAAQ,EAAE;AADW,OAAvB;AAGAf,MAAAA,GAAG,CAACa,GAAJ,CAAQG,GAAR;AACD,KALD,MAKO;AACLrB,MAAAA,MAAM,CAACsB,IAAP,CAAY,GAAZ;AACD;AACF;AACF","sourcesContent":["import axios from 'axios';\r\nimport Router from 'next/router';\r\nimport { Cookies } from 'react-cookie';\r\n// set up cookies\r\nconst cookies = new Cookies();\r\nconst serverUrl = 'http://localhost:3001';\r\n\r\nexport async function handleAuthSSR(ctx) {\r\n  let token = null;\r\n\r\n  // if context has request info aka Server Side\r\n  if (ctx.req) {\r\n    // ugly way to get cookie value from a string of values\r\n    // good enough for demostration\r\n    token = ctx.req.headers.cookie.replace(/(?:(?:^|.*;\\s*)token\\s*\\=\\s*([^;]*).*$)|^.*$/, \"$1\");\r\n  }\r\n  else {\r\n    // we dont have request info aka Client Side\r\n    token = cookies.get('token')\r\n  }\r\n\r\n  try {\r\n    console.log('vaimee')\r\n    const response = await axios.get(serverUrl + \"/api/token/ping\", { headers: { 'Authorization': token } });\r\n    // dont really care about response, as long as it not an error\r\n    console.log(\"token ping:\", response.data.msg)\r\n  } catch (err) {\r\n    // in case of error\r\n    console.log(err.response.data.msg);\r\n    console.log(\"redirecting back to main page\");\r\n    // redirect to login\r\n    if (ctx.res) {\r\n      ctx.res.writeHead(302, {\r\n        Location: '/'\r\n      })\r\n      ctx.res.end()\r\n    } else {\r\n      Router.push('/')\r\n    }\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}